<!DOCTYPE html>

<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Sailer</title>

    <script src="scripts/jquery-2.2.0.min.js"></script>
    <script src="scripts/bootstrap.min.js"></script>
    <link rel="stylesheet" href="css/bootstrap.min.css">

    <script src="scripts/jquery.dataTables.min.js"></script>
    <script src="scripts/dataTables.bootstrap.min.js"></script>
    <link rel="stylesheet" href="css/dataTables.bootstrap.min.css">
</head>
<body>
    <nav class="navbar navbar-default">
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="index.html">Sailer</a>
            </div>
            <div id="navbar" class="navbar-collapse collapse">
                <ul class="nav navbar-nav">
                    <li class="active"><a href="anime.html">动画</a></li>
                    <li><a href="me.html">关于</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="jumbotron">
            <p>
                <span class="glyphicon glyphicon-list" aria-hidden="true"></span>
                <span id="textready">连接文件服务器……</span>
            </p>
        </div>
        <table id="content" class="table table-striped">
            <thead>
                <tr>
                    <th>标题</th>
                    <th>周</th>
                    <th>集</th>
                </tr>
            </thead>
        </table>
        <form style="margin-bottom: 10px">
            <button type="button" class="btn btn-primary" disabled="disabled" onclick="lookfor()">查找</button>
        </form>
    </div>

    <script>
        var table = $("#content").dataTable({
            "order": [[1, "asc"]],
            "bFilter": false,
            "bInfo": false,
            "bPaginate": false
        });
        var weekdays = ["星期日（日曜日）", "星期一（月曜日）", "星期二（火曜日）", "星期三（水曜日）", "星期四（木曜日）", "星期五（金曜日）", "星期六（土曜日）"];
        var keyword = null;

        $.ajax({
            url: "http://mysticmonkey.co.nf/Anime.xml",
            type: "GET",
            success: function (response) {
                $("#textready").text("已连接文件服务器");
                $(response).find("AnimeInfo").each(function (index, anime) {
                    var array = [];

                    var time = new Date($(anime).find("First").text());
                    var weeks = Math.ceil((new Date() - time) / (7 * 24 * 3600 * 1000));

                    array.push($(anime).find("Title").text());
                    array.push(weekdays[$(anime).find("Weekday").text()]);
                    array.push(weeks);
                    array.push($(anime).find("Keyword").text());

                    table.fnAddData(array);
                });
            }
        });

        $("#content tbody").on("click", "tr", function () {
            $("#content tbody .info").removeClass("info");
            $(this).addClass("info");

            keyword = $("#content").DataTable().rows(this).data()[0][3];
            $(".btn-primary").removeAttr("disabled");
        });

        function lookfor() {
            window.open("https://share.dmhy.org/topics/list?keyword=" + keyword);
        }
    </script>

    <!-- Cordova 引用，它在生成应用程序时添加到其中。 -->
    <script src="cordova.js"></script>
    <script src="scripts/platformOverrides.js"></script>
</body>
</html>